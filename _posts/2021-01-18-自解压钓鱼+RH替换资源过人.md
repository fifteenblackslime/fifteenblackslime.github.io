### 一、 前言

自解压+RH替换资源的鱼饵制作，翻炒冷饭。

### 二、 原理
#### 2.1 自解压钓鱼
主要是利用压缩包的自解压设置，自解压指的是在没有压缩软件的主机上也可以进行解压的技术，生成的是exe文件。并且可以设置在解压的时候执行某一段程序，这段程序被称为sfx程序，最终达到伪装成正常应用程序效果。

#### 2.2 RH替换资源过人
通过Resource Hacker替换自解压文件资源达到伪装正常应用程序的效果。

### 三、 如何制作

#### 3.1 创建自解压文件
选定准备好的后门文件与想要伪装的正常程序，添加至压缩包，创建**自解压格式**压缩文件。
![](https://p2.ssl.qhimg.com/t0162dd246119438c7d.png)
![](https://p2.ssl.qhimg.com/t01eb86c60de7675c6d.png)

在**高级-自解压选项**中设置自解压路径，如 C:\windows\temp。
此路径将会是自解压文件运行后，我们的后门程序与正常程序解压缩地址。当然，如果只打包后门程序，可以考虑解压至启动文件目录。

![](https://p0.ssl.qhimg.com/t010cd55d3d993f10eb.png)

在**高级自解压选项-设置选项卡**中设置解压缩后的启动程序路径。
以常见的flashplayer为例，此处出于隐蔽性的考虑，将伪装的flashplayer安装包一并打包进去，同时在解压后运行中也让其能够执行。让受害者执行我们自解压文件后获得一个正常功能的回显。

![](https://p0.ssl.qhimg.com/t01ae871c57b4c5a408.png)

在**高级自解压选项-模式选项卡**中，设置解压过程的全部隐藏

![](https://p0.ssl.qhimg.com/t0192ebfe38e8c31d14.png)

在**高级自解压模式-更新选项卡**中，设置更新和覆盖，防止临时目录下存在同名文件或自解压文件多次使用提示已存在文件等可能暴露的信息。

![](https://p2.ssl.qhimg.com/t0103a3b30fe675a339.png)

此时我们就获取了一个自解压钓鱼文件，面貌如下：

![](https://p4.ssl.qhimg.com/t0137db846cf40d7e95.png)

#### 3.2 ResourceHacker替换资源

3.2.1 对于已存在资源的替换

我们需要将该文件伪装成目标文件最直观的一点，在于**图标的伪装**。
所以我们需要从被伪装文件中提取相关的图标文件。

![](https://p3.ssl.qhimg.com/t01f85f18b19a5cfd4c.png)

替换自解压文件图标资源。

![](https://p3.ssl.qhimg.com/t01d2f540cf9fd9090d.png)

替换结果如下：

![](https://p3.ssl.qhimg.com/t01ed9fcb2a274280a1.png)

3.2.2 对于不存在资源的添加

在伪装过程中，有时会遇到我们需要伪装的文件存在的信息在使用RH查看自解压文件时不存在的场景，此时我们就需要进行资源的添加。
比如在这个例子中，文件的详细信息处我们就可以看到，我们伪造的文件是空的，并且通过RH查看确认不存在versioninfo的。

![](https://p0.ssl.qhimg.com/t01e39caf44f1d10635.png)

我们通过RH的Action选项中的Add using Script Template选项添加资源（快捷键为Ctrl+T)。

![](https://p2.ssl.qhimg.com/t01761f16d26660517f.png)

![](https://p0.ssl.qhimg.com/t01e8eced216201afb3.png)

这里我们可以采用Ctrl+C，Ctrl+V大法，copy我们目标文件的信息后点击save保存。

![](https://p4.ssl.qhimg.com/t01a9ac74dd30c56c17.png)

最后获取到的文件结果如下：

![](https://p3.ssl.qhimg.com/t015d56e1147b819f15.png)

### 四、 结果展示

#### 制作完钓鱼文件后，要修改名字。

![](https://p5.ssl.qhimg.com/t01571c9b4772877957.png)

双击执行后，我这边完成效果如下：

![](https://p1.ssl.qhimg.com/t0116496c7a073abfe8.png)

配合了自己的免杀方法，以及后门隐藏姿势的话，最终可以达到temp目录下执行完成后无文件的结果。

火绒：

![](https://p3.ssl.qhimg.com/t01bfcfe776fe96ca9c.png)

360：

![](https://p2.ssl.qhimg.com/t01301400a9cf76be10.png)
![](https://p4.ssl.qhimg.com/t0104109160e61c567f.png)

defender：

![](https://p3.ssl.qhimg.com/t01da1831024aea79a3.png)

### 五、缺点及不足

虽然通过种种方法，我们可以实现像上述过程一样伪装成任意想伪装成的文件，但自解压钓鱼文件存在着一些比较严重的问题。
比如：在我之前的对比截图中，嗯就是下面这张，我们可以看到，在属性窗口中存在着一个严重的问题，那就是**正常安装包的子选项卡中是数字签名**，而自解压文件的子选项卡中是**压缩文件**和**注释**。

![](https://p0.ssl.qhimg.com/t01e39caf44f1d10635.png)

通过这种方法我们是可以非常有效的识别，我们获取到的安装包是否是伪装过的自解压后门程序。当然，对下载文件进行hash校验也是十分可行的。
告诉大家一个坑，那就是
👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇👇

![](https://p4.ssl.qhimg.com/t01a7916e0a5e80f4d0.png)